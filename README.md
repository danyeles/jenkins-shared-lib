=======================================

README #1 — jenkins-shared-library

=======================================

# Jenkins Shared Library — Docker Deployment Framework

A reusable Jenkins Shared Library for deploying Dockerized applications using YAML-based configuration. This library powers all `deploy-*` jobs generated by the seed pipeline.

---

## Purpose

This repository contains:

- Reusable Jenkins pipeline logic (`vars/appPipeline.groovy`)
- YAML configuration files for each application (`resources/configs/*.yaml`)
- A standardized deployment workflow for Docker containers

It allows you to deploy any app by simply adding a YAML file—no Jenkinsfile duplication, no per‑app repos, and no Groovy DSL files.

---

## Repository Structure

jenkins-shared-library/
vars/
appPipeline.groovy
resources/
configs/
sonarr.yaml
radarr.yaml
bazarr.yaml
...

Code

---

## How the Shared Library Works

1. The seed job generates Jenkins jobs like:
   - `deploy-sonarr`
   - `deploy-radarr`
   - `deploy-bazarr`

2. Each generated job loads this library:

```groovy
@Library('my-shared-lib') _
appPipeline(
  appName: 'sonarr',
  configFile: 'configs/sonarr.yaml'
)
```

3. The library loads the YAML config:
```
def cfg = readYaml text: libraryResource(args.configFile)
```

4. The library builds and executes the correct Docker commands:

- Pull image (if Update)
- Stop/remove container (if Update)
- Start container (if Stop and Run)
- Deploy container (if Deploy)

Example YAML Config
resources/configs/sonarr.yaml

```
container: sonarr
image: lscr.io/linuxserver/sonarr
tag: latest
restart: always

ports:
  - "8989:8989"

env:
  PUID: "1000"
  PGID: "1000"
  TZ: "America/Monterrey"

volumes:
  - "/home/docker/sonarr/config:/config"
  - "/mnt/Media:/Media"
  - "/mnt/Media/Downloads:/downloads"
  - "/mnt/Media/TVShows:/TVShows"
  - "/mnt/Media/MyShows:/MyShows"
```


Installing the Shared Library in Jenkins
1. Go to:
Manage Jenkins → Configure System → Global Pipeline Libraries

2. Add a new library:
- Name: my-shared-lib
- Default version: main
- Retrieval method: Modern SCM
- SCM: Git
- Repository URL: https://github.com/<your-user>/jenkins-shared-library.git
- Credentials: GitHub token
- Load implicitly: No
- Allow default version to be overridden: Yes

Required Jenkins Plugins
- Pipeline Utility Steps
- Job DSL
- Pipeline: Groovy
- Pipeline: Shared Groovy Libraries
- Git plugin
- Credentials Binding
- Docker Pipeline

Jenkins Host Requirements
- Install Docker
```
sudo apt update
sudo apt install docker.io -y
sudo systemctl enable docker
sudo systemctl start docker
```
- Add Jenkins user to Docker group
```
sudo usermod -aG docker jenkins
sudo systemctl restart jenkins
```

Deploying an App
- Add a YAML file under resources/configs/
- Add an entry in apps.yaml (in jenkins‑infra repo)
- Run the seed job
- Run the generated deploy-<app> job
